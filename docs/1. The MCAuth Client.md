# 1. MCAuth Client
This describes how the Spigot plugin operates from a shorten overview.

# A Player Connects
When a player connects to the Minecraft server, the [MCAuth Client plugin](https://github.com/dhghf/mcauth)
will reach out to MCAuth to verify the player.

## If They're Verified
When MCAuth Client gets a response that says the player is verified then the
plugin will continue to do nothing.


__An Example Response__

| Attribute | Type    | Description             |
|-----------|---------|-------------------------|
| valid     | boolean | Always true if verified |


```json
{
	"valid": false
}
```


## If They're Not Verified
When MCAuth detects that they're not verified, it will provide a reason why
they're not authenticated. MCAuth Client then needs to kick the player with a
given reason, which again is granted by the MCAuth server.

__An Example Response__

| Attribute | Type    | Description                            |
|-----------|---------|----------------------------------------|
| valid     | boolean | Always false if they're not verified   |
| reason    | string  | Possible reasons are described below   |

```json
{
	"valid": false,
	"reason": "no_role"
}
```

# The Reasons
Here's a list of all the reasons a player might have been kicked.
 * **auth_code**   - The player still needs to link their account.
 * **maintenance** - The server is under maintenance and is only accepting admin.
 * **no_role**     - The player is missing a required role to join the server.


### Authentication Codes

This reason is fundamental. It grants the player their authentication code
needed to link their Discord and Minecraft accounts. MCAuth Client should 
display the player's code to be able to enter the server.

__An Example Response__

| Attribute | Type    | Description                                 |
|-----------|---------|---------------------------------------------|
| valid     | boolean | Always false in this case.                  |
| reason    | string  | This can only be "auth_code".               |
| auth_code | string  | The authentication code generated by MCAuth |

```json
{
	"reason": "auth_code",
	"valid": false,
	"auth_code": "9bc093bd"
}
```


### No Role

The minimum required roles are set under the whitelist attribute of the
[config.yml](./extra/Configuration.md). If the player connecting doesn't have 
at least one of the required roles, they will be kicked.


__An Example Response__

```json
{
	"valid": false,
	"reason": "no_role"
}
```

### Maintenance

Known as "maintenance mode", this is done by the administrators of the bot.
Administrators are determined by the "administrators" attribute of the 
[config.yml](./extra/Configuration.md). When maintenance mode is on the 
verification process only accepts bot administrators and their alt accounts.

__An Example Response__

```json
{
	"valid": false,
	"reason": "maintenance"
}
```


# Developer's Notes

## Kick Delay (for the less fortunate)
It's important that there is a delay when the player gets kicked. This is 
because if the player's client hasn't connected all the way, they will
receive a "the connection has been dropped" instead of the given reason
why they were kicked. By default, this is [six seconds](https://github.com/dhghf/mcauth-client/blob/production/src/main/resources/config.yml#L4) so that the player will always receive their auth code.
